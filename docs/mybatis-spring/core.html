<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Feb 11, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130211" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis - 
    MyBatis Guice | The Core components</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../" id="bannerLeft" title="MyBatis logo">
                                                                                                <img src="../images/logo.png"  alt="MyBatis logo"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 11 February 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 3.4-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Reference Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Core components</a>
          </li>
                                                                                                                    
      <li>
    
                          <a href="datasources.html" title="Data Sources">
          <i class="icon-chevron-down"></i>
        Data Sources</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="datasources/builtin.html" title="MyBatis built-in">
          <i class="none"></i>
        MyBatis built-in</a>
            </li>
                      
      <li>
    
                          <a href="datasources/dbcp.html" title="Apache Commons DBCP">
          <i class="none"></i>
        Apache Commons DBCP</a>
            </li>
                      
      <li>
    
                          <a href="datasources/c3p0.html" title="C3P0">
          <i class="none"></i>
        C3P0</a>
            </li>
                      
      <li>
    
                          <a href="datasources/bonecp.html" title="BoneCP">
          <i class="none"></i>
        BoneCP</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="injections.html" title="Injections">
          <i class="none"></i>
        Injections</a>
            </li>
                  
      <li>
    
                          <a href="transactional.html" title="@Transactional">
          <i class="none"></i>
        @Transactional</a>
            </li>
                  
      <li>
    
                          <a href="jdbc-helper.html" title="JDBC Helper">
          <i class="none"></i>
        JDBC Helper</a>
            </li>
                  
      <li>
    
                          <a href="samples.html" title="Samples">
          <i class="none"></i>
        Samples</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Introduction<a name="Introduction"></a></h2>
        <p>
            Core components are contained in the <i>org.mybatis.guice.*</i>
            package, providing a set of reusable Google Guice
            <i>javax.inject.Provider</i>s and
            <i>com.google.inject.Module</i>s that
            alleviate users the task to create MyBatis objects.
        </p>
    </div>

    <div class="section"><h2>MyBatis Bootstrap<a name="MyBatis_Bootstrap"></a></h2>
        <p>
            MyBatis offers an excellent APIs layer for the Bootstrap configuration that makes
            it easy to write custom bootstrap - by default MyBatis comes with the XML loader -
            and integrating 3rd part components.
        </p>
        <p>
            The core component of the Guice approach is represented by the
            <i>org.mybatis.guice.MyBatisModule</i> that's able to
            create the core MyBatis <i>org.apache.ibatis.session.SqlSessionFactory</i>,
            <i>org.apache.ibatis.session.SqlSessionManager</i> and
            the user defined <i>Mappers</i>.
        </p>
        <p>
            The best way to start is just adding the
            <i>org.mybatis.guice.MyBatisModule</i> into the
            <i>com.google.inject.Injector</i>
            as shown in the example below and explain details step by step:

                </p><div class="source"><pre class="prettyprint">Class&lt;? extends Provider&lt;DataSource&gt;&gt; dataSourceProviderType = [...];

Class&lt;? extends TransactionFactory&gt; txFactoryClass = [...];

Injector injector = Guice.createInjector(
    new MyBatisModule() {

        @Override
        protected void initialize() {
            environmentId(&quot;development&quot;);
            bindDataSourceProviderType(dataSourceProviderType);
            bindTransactionFactoryType(txFactoryClass);
        }

    },
    ...
);

SqlSessionFactory sessionFactory = injector.getInstance(SqlSessionFactory.class);
SqlSessionManager sessionManager = injector.getInstance(SqlSessionManager.class);
MyMapper mapper = injector.getInstance(MyMapper.class);</pre></div>

            Let's have a look now at the MyBatis module components and features:
        
        </div>

        <div class="section"><h2>MyBatis properties<a name="MyBatis_properties"></a></h2>
            <p>
                By design, we choose to reuse the default configuration
                properties provided by Guice to let users feel free to read and
                set them in any way you prefer; we suggest to put it in a
                properties file, maybe filtered and set depending on which
                environment users are building the application.
            </p>
            <p>
                By default, if a configuration property is not specified, it will be ignored and
                MyBatis will take care about proper default initialization. Users can initialize
                properties using the proper setters OR by following method (please don't bind properties twice!):
                </p><div class="source"><pre class="prettyprint">binder.bindConstant()
    .annotatedWith(Names.named(&quot;mybatis.configuration.XXX&quot;))
    .to(XXXvalue);</pre></div>
            
            <p>
            The MyBatis module supports the following parameters:</p>
            <table border="0" class="table table-striped"><caption>org.mybatis.guice.MyBatisModule properties</caption>
                
                <thead>
                    <tr class="a">
                        <th>Property</th>
                        <th>Setter</th>
                        <th>Default</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="b">
                        <td>mybatis.environment.id</td>
                        <td>environmentId(String)</td>
                        <td>Not set, it is required</td>
                    </tr>
                    <tr class="a">
                        <td>mybatis.configuration.lazyLoadingEnabled</td>
                        <td>lazyLoadingEnabled(boolean)</td>
                        <td>false</td>
                    </tr>
                    <tr class="b">
                        <td>mybatis.configuration.aggressiveLazyLoading</td>
                        <td>aggressiveLazyLoading(boolean)</td>
                        <td>true</td>
                    </tr>
                    <tr class="a">
                        <td>mybatis.configuration.multipleResultSetsEnabled</td>
                        <td>multipleResultSetsEnabled(boolean)</td>
                        <td>true</td>
                    </tr>
                    <tr class="b">
                        <td>mybatis.configuration.useGeneratedKeys</td>
                        <td>useGeneratedKeys(boolean)</td>
                        <td>false</td>
                    </tr>
                    <tr class="a">
                        <td>mybatis.configuration.useColumnLabel</td>
                        <td>useColumnLabel(boolean)</td>
                        <td>true</td>
                    </tr>
                    <tr class="b">
                        <td>mybatis.configuration.cacheEnabled</td>
                        <td>useCacheEnabled(boolean)</td>
                        <td>true</td>
                    </tr>
                    <tr class="a">
                        <td>mybatis.configuration.defaultExecutorType</td>
                        <td>executorType(ExecutorType)</td>
                        <td>ExecutorType.SIMPLE</td>
                    </tr>
                    <tr class="b">
                        <td>mybatis.configuration.autoMappingBehavior</td>
                        <td>autoMappingBehavior(AutoMappingBehavior)</td>
                        <td>AutoMappingBehavior.PARTIAL</td>
                    </tr>
                    <tr class="a">
                        <td>mybatis.configuration.failFast</td>
                        <td>failFast(boolean)</td>
                        <td>false</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section"><h2>The DataSource Provider<a name="The_DataSource_Provider"></a></h2>
            <p>
                The <i>javax.sql.DataSource</i> Provider is one of
                the two required providers that takes care about building and
                injecting the used <i>javax.sql.DataSource</i>.
            </p>
            <p>
                The mybatis-guice framework comes with some providers that
                support the MyBatis-native Data Sources and other well known
                Data Sources, <i>C3P0</i>,
                <i>Apache Commons DBCP</i> and <i>BoneCP</i> but users are free to
                implement their own <i>javax.sql.DataSource</i>
                Provider and reference it in the <i>org.mybatis.guice.MyBatisModule</i>.
            </p>
            <p>
                Please read the following chapter <i>Data Source Providers</i>
                to obtain more informations about natively supported providers.
            </p>
        </div>

        <div class="section"><h2>The Transaction Factory<a name="The_Transaction_Factory"></a></h2>
            <p>
                Users are free to plug their preferred <i>org.apache.ibatis.transaction.TransactionFactory</i>:

                </p><div class="source"><pre class="prettyprint">Class&lt;? extends org.apache.ibatis.transaction.TransactionFactory&gt; txFactoryType = ...

Module module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        bindTransactionFactoryType(txFactoryType);
        ...
    }

}</pre></div>
            
        </div>

        <div class="section"><h2>Configuring aliases<a name="Configuring_aliases"></a></h2>
            <p>
                Once users create the <i>org.mybatis.guice.MyBatisModule.Builder</i>,
                it's quite easy plugging optional MyBatis components, like
                aliases: here users can define simple aliases, for example
                <i>Foo</i> that stands for <i>com.acme.Foo</i>,
                or custom aliases, for example <i>MyFoo</i> that
                stands for <i>com.acme.Foo</i>.
            </p>
            <p>
                We found it very useful to add simple aliases because it helped us reduce errors during
                development; just call:
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        addSimpleAlias(com.acme.Foo.class);
        addSimpleAlias(com.acme.Bar.class);
        addSimpleAlias(...);
        ...
    }

}</pre></div>
            
            <p>
                If you prefer custom aliases, just invoke:
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        addAlias(&quot;MyFoo&quot;).to(com.acme.Foo.class);
        addAlias(&quot;MyBar&quot;).to(com.acme.Bar.class);
        ...
    }

}</pre></div>
            
        </div>

        <div class="section"><h2>Configuring Type Handlers<a name="Configuring_Type_Handlers"></a></h2>
            <p>
                Users can also configure type handlers: given the com.acme.Foo type, that has to be handled by
                the type handler <i>com.acme.dao.FooHandler</i>, just invoke
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        handleType(com.acme.Foo.class).with(com.acme.dao.FooHandler.class);
        handleType(com.acme.Bar.class).with(com.acme.dao.BarHandler.class);
        ...
    }

}</pre></div>
                and let Google Guice create the handlers instances and bind them to be injected to MyBatis components.
            
        </div>

        <div class="section"><h2>Configuring Interceptor Plugins<a name="Configuring_Interceptor_Plugins"></a></h2>
            <p>
                Users can easily add their preferred <i>org.apache.ibatis.plugin.Interceptor</i>
                by invoking:
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        addInterceptorClass(com.acme.dao.FooInterceptor.class);
        addInterceptorClass(com.acme.dao.BarInterceptor.class);
        ...
    }

}</pre></div>
                and let Google Guice create the interceptors instances and bind them to be injected to MyBatis components.
            
        </div>

        <div class="section"><h2>Configuring Mappers<a name="Configuring_Mappers"></a></h2>
            <p>
                Users can add <i>Mapper</i> classes to the module by invoking:
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        addMapperClass(com.acme.dao.FooMapper.class);
        addMapperClass(com.acme.dao.BarMapper.class);
        ...
    }

};</pre></div>
                and let Google Guice create the mappers instance and bind them to be injected to MyBatis components.
            
        </div>

        <div class="section"><h2>Configuring the Object Factory<a name="Configuring_the_Object_Factory"></a></h2>
            <p>
                Simply define your own <i>org.apache.ibatis.reflection.factory.ObjectFactory</i>
                and communicate it to the module and let Google Guice create it:
                </p><div class="source"><pre class="prettyprint">MyBatisModule module = new MyBatisModule() {

    @Override
    protected void initialize() {
        ...
        bindObjectFactoryType(com.acme.MyObjectFactory.class);
        ...
    }

};</pre></div>
            
        </div>

    <div class="section"><h2>Multiple Datasources<a name="Multiple_Datasources"></a></h2>
        <p>
            It often happens that users need to interact with multiple schemas
            in the same application, that means to have separate MyBatis
            configurations.
        </p>
        <p>
            Fortunately, the Google Guice <i>com.google.inject.PrivateModule</i>
            comes to help us in a very simple and smart way, that will be shown in
            the following example.
        </p>
        <p>
            Let's take in consideration, to simplify the example, we have only
            two datasources (but the same concept can be extended for an
            arbitrary data sources number) one for the <i>contacts</i>
            schema and another one for the <i>companies</i> schema.
            So, all it has to do is installing the <i>org.mybatis.guice.MyBatisModule</i>
            modules into the Google Guice <i>com.google.inject.PrivateModule</i>
            as shown below:
            </p><div class="source"><pre class="prettyprint">Injector injector = Guice.createInjector(
    new PrivateModule() {
        @Override
        protected void configure() {
            install(new MyBatisModule() {

                @Override
                protected void initialize() {
                    bindDataSourceProviderType(PooledDataSourceProvider.class);
                    bindTransactionFactoryType(JdbcTransactionFactory.class);
                    addMapperClass(ContactMapper.class);
                    addSimpleAlias(Contact.class);
                }

            });
            Names.bindProperties(this.binder(),
                getConnectionProperties(&quot;contacts&quot;));
            // binds Mappers/DAOs here
            bind(ContactDao.class).to(ContactDaoImpl.class);
            ...

            // exposes Mappers/DAOs here
            expose(ContactDao.class);
            ...
        }
    }, new PrivateModule() {
        @Override
        protected void configure() {
            install(new MyBatisModule() {

                @Override
                protected void initialize() {
                    bindDataSourceProviderType(PooledDataSourceProvider.class);
                    bindTransactionFactoryType(JdbcTransactionFactory.class);
                }

            });
            Names.bindProperties(this.binder(),
                getConnectionProperties(&quot;trades&quot;));
            // binds Mappers/DAOs here
            bind(CompanyDao.class).to(CompanyDaoImpl.class);
            ...

            // exposes Mappers/DAOs here
            expose(CompanyDao.class);
            ...
        }
    }
);</pre></div>
        
        <p>
            The example shows how to use the <i>org.mybatis.guice.MyBatisModule</i>
            to create two different MyBatis configurations in the same context.
            Feel free to implement the <i>getConnectionProperties()</i>
            method in the way you prefer! It could be, for example:
            </p><div class="source"><pre class="prettyprint">private final static Properties getConnectionProperties(String schema) {
    final Properties myBatisProperties = new Properties();

    myBatisProperties.setProperty(&quot;mybatis.environment.id&quot;, &quot;test&quot;);
    myBatisProperties.setProperty(&quot;JDBC.driver&quot;,
        &quot;org.apache.derby.jdbc.EmbeddedDriver&quot;);
    myBatisProperties.setProperty(&quot;JDBC.url&quot;,
        &quot;jdbc:mysql://localhost:3306/&quot; + schema);
    myBatisProperties.setProperty(&quot;JDBC.username&quot;, &quot;mybatis-user&quot;);
    myBatisProperties.setProperty(&quot;JDBC.password&quot;, &quot;changeme&quot;);
    myBatisProperties.setProperty(&quot;JDBC.autoCommit&quot;, &quot;true&quot;);

    return myBatisProperties;
}</pre></div>
        
    </div>

    <div class="section"><h2>MyBatis XML Bootstrap<a name="MyBatis_XML_Bootstrap"></a></h2>
        <p>
            Users that want configure the MyBatis via the XML configuration, without loosing any single feature
            of the <i>org.mybatis.guice.MyBatisModule</i>, can create their Injector using the
            <i>org.mybatis.guice.XMLMyBatisModule</i>.
        </p>
        <p>
            <i>XMLMyBatisModule</i> clients have just to instantiate it specifying</p>
            <ol style="list-style-type: decimal">
                <li><p>the MyBatis XML configuration file, located in the classpath, by default
                the module will look for <i>mybatis-config.xml</i> in the root in the classpath;</p></li>
                <li><p>the optional MyBatis <i>environmentId</i>, <i>development</i> by default;</p></li>
                <li><p>the optional <i>java.util.Properties</i> to fill placeholders in the MyBatis XML configuration,
                empty by default.</p></li>
            </ol>
        <p>
            A typical use case could be identified in the following code snippet:</p>
            <div class="source"><pre class="prettyprint">Properties props = new Properties();
props.setProperty(&quot;JDBC.username&quot;, &quot;mybatis-user&quot;);
props.setProperty(&quot;JDBC.password&quot;, &quot;changeme&quot;);

Injector injector = Guice.createInjector(
    new XMLMyBatisModule() {

        @Override
        protected void initialize() {
            setEnvironmentId(&quot;test&quot;);
            setClassPathResource(&quot;my/path/to/mybatis-config.xml&quot;);
            addProperties(props);
        }

    },
    ...
);</pre></div>
                <p><span class="label important">Important</span>
                    Google Guice will inject dependencies, if required, in the
                    <i>TypeHandler</i>s and <i>Interceptor</i>s.
                </p>
    </div>

  


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
